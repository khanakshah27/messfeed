<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Submitted Feedbacks - MessFeed</title>
    <style>
        body {
            background-color: #2D2A6E;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            text-align: center;
        }
        .navbar {
            background-color: #cfdde6f7;
            font-family: Poppins, Arial, sans-serif;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 40px;
            border-radius: 10px;
            max-width: 80%;
            margin: 20px auto 0 auto;
        }
        .navbar a {
            color: black;
            text-decoration: none;
            margin: 0 15px;
            font-weight: bold;
        }
        .navbar .signout {
            background-color: #3B3A98;
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
        }
        .navbar .signout:hover {
            background-color: #2D2A6E;
        }
        h1 {
            color: white;
            font-size: 2.5em;
            margin-top: 30px;
        }
        table {
            margin: 30px auto;
            width: 80%;
            border-collapse: collapse;
            background-color: #35317f;
            color: white;
            border-radius: 8px;
            overflow: hidden;
        }
        th, td {
            padding: 16px;
            border-bottom: 1px solid #cfdde6f7;
            text-align: center;
        }
        th {
            background-color: #cfdde6f7;
            color: #2D2A6E;
            font-weight: bold;
        }
        tr:last-child td {
            border-bottom: none;
        }
        .empty-message {
            color: #cfdde6f7;
            font-size: 1.3em;
            margin-top: 40px;
        }
    </style>
</head>
<body>
    <div class="navbar">
        <div class="logo"><strong>MessFeed</strong></div>
        <div>
            <a href="{{ url_for('feedback') }}">Feedback Form</a>
            <a href="{{ url_for('userfeeds') }}">My Feedbacks</a>
            <a href="{{ url_for('home') }}">Home</a>
            <a href="{{ url_for('faq') }}">FAQ</a>
        </div>
        <a href="{{ url_for('home') }}"><button class="signout" onclick="signOut()">Sign Out</button></a>
    </div>

    <h1>My Submitted Feedbacks</h1>
    <div id="feedbackTableContainer"></div>

    <script>
        // Session storage
        const user_id = localStorage.getItem('user_email'); 

        function signOut() {
            localStorage.clear();
            window.location.href = "feedlog.html";
        }

        async function fetchFeedbacks() {
            if (!user_email) {
                document.getElementById("feedbackTableContainer").innerHTML =
                    '<div class="empty-message">Please sign in to see your feedbacks.</div>';
                return;
            }
            const url = `/api/userfeedbacks?email=${encodeURIComponent(user_email)}`;
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error('Failed to fetch feedbacks');
                const feedbacks = await response.json();
                renderTable(feedbacks);
            } catch (err) {
                document.getElementById("feedbackTableContainer").innerHTML =
                    `<div class="empty-message">Could not load feedbacks.</div>`;
            }
        }

        function renderTable(feedbacks) {
            if (!feedbacks.length) {
        document.getElementById("feedbackTableContainer").innerHTML =
            '<div class="empty-message">No feedbacks submitted yet!</div>';
        return;
    }
    let html = `<table>
                    <tr>
                        <th>Feedback ID</th>
                        <th>Reg No</th>
                        <th>Category</th>
                        <th>Date/Time</th>
                        <th>Feedback</th>
                        <th>Status</th>
                        <th>Admin ID</th>
                        <th>Admin Comments</th>
                    </tr>`;
    feedbacks.forEach(fb => {
        html += `<tr>
                    <td>${fb.id || fb.feedback_id || '-'}</td>
                    <td>${fb.registration_number || fb.reg_no || '-'}</td>
                    <td>${fb.category || '-'}</td>
                    <td>${fb.timestamp ? new Date(fb.timestamp).toLocaleString() : '-'}</td>
                    <td>${fb.feedback || '-'}</td>
                    <td>${fb.status || 'Pending'}</td>
                    <td>${fb.admin_id || '-'}</td>
                    <td>${fb.admin_comment || fb.admin_comments || '-'}</td>
                </tr>`;
    });
    html += `</table>`;
    document.getElementById("feedbackTableContainer").innerHTML = html;
        }

        fetchFeedbacks();
    </script>
</body>
</html>
